#include "stm32f10x.h"
#include "delay.h"
#include "remote.h"
#include "usart.h"
#include "ir.h"
#include "key.h"
#include "led.h"

u16 Code_ON[] = {8482
                 , 4086
                 , 601
                 , 492
                 , 576
                 , 1568
                 , 577
                 , 1569
                 , 575
                 , 517
                 , 574
                 , 1569
                 , 577
                 , 517
                 , 575
                 , 1569
                 , 577
                 , 523
                 , 576
                 , 516
                 , 575
                 , 1569
                 , 579
                 , 516
                 , 574
                 , 1568
                 , 576
                 , 1569
                 , 578
                 , 1567
                 , 576
                 , 1569
                 , 576
                 , 526
                 , 573
                 , 517
                 , 575
                 , 516
                 , 575
                 , 520
                 , 574
                 , 517
                 , 576
                 , 517
                 , 578
                 , 516
                 , 572
                 , 517
                 , 575
                 , 523
                 , 577
                 , 517
                 , 576
                 , 516
                 , 573
                 , 517
                 , 573
                 , 520
                 , 577
                 , 515
                 , 574
                 , 519
                 , 575
                 , 518
                 , 576
                 , 523
                 , 574
                 , 519
                 , 573
                 , 526
                 , 565
                 , 518
                 , 573
                 , 519
                 , 575
                 , 1568
                 , 576
                 , 518
                 , 572
                 , 520
                 , 574
                 , 523
                 , 574
                 , 520
                 , 573
                 , 520
                 , 573
                 , 518
                 , 574
                 , 518
                 , 575
                 , 517
                 , 576
                 , 517
                 , 575
                 , 518
                 , 575
                 , 523
                 , 574
                 , 518
                 , 574
                 , 519
                 , 574
                 , 559
                 , 531
                 , 521
                 , 573
                 , 518
                 , 578
                 , 514
                 , 574
                 , 1569
                 , 576
                 , 525
                 , 574
                 , 518
                 , 574
                 , 519
                 , 572
                 , 521
                 , 578
                 , 512
                 , 572
                 , 518
                 , 574
                 , 531
                 , 564
                 , 516
                 , 576
                 , 524
                 , 575
                 , 520
                 , 568
                 , 518
                 , 574
                 , 522
                 , 572
                 , 518
                 , 571
                 , 516
                 , 576
                 , 523
                 , 565
                 , 520
                 , 575
                 , 527
                 , 610
                 , 476
                 , 575
                 , 517
                 , 577
                 , 514
                 , 576
                 , 517
                 , 574
                 , 522
                 , 574
                 , 515
                 , 574
                 , 516
                 , 574
                 , 524
                 , 575
                 , 516
                 , 575
                 , 517
                 , 578
                 , 514
                 , 576
                 , 516
                 , 576
                 , 516
                 , 582
                 , 518
                 , 651
                 , 434
                 , 577
                 , 522
                 , 582
                 , 535
                 , 549
                 , 516
                 , 575
                 , 518
                 , 576
                 , 517
                 , 575
                 , 517
                 , 575
                 , 516
                 , 576
                 , 517
                 , 579
                 , 522
                 , 573
                 , 516
                 , 575
                 , 517
                 , 575
                 , 517
                 , 576
                 , 520
                 , 598
                 , 490
                 , 576
                 , 516
                 , 577
                 , 520
                 , 575
                 , 520
                 , 576
                 , 519
                 , 574
                 , 514
                 , 575
                 , 517
                 , 576
                 , 515
                 , 578
                 , 517
                 , 576
                 , 514
                 , 575
                 , 518
                 , 601
                 , 496
                 , 577
                 , 1600
                 , 546
                 , 514
                 , 601
                 , 490
                 , 576
                 , 516
                 , 575
                 , 523
                 , 596
                 , 1540
                 , 581
                 , 512
                 , 576
                 , 519
                 , 606
                },
                Code_OFF[] = {8452,     4143,      520,      574,      518,     1626,
                              519,     1626,      519,      573,      520,     1628,
                              522,      569,      518,     1626,      520,      553,
                              545,      547,      545,     1599,      547,      546,
                              546,     1597,      549,     1597,      547,     1596,
                              549,     1597,      549,      548,      552,      541,
                              553,      542,      550,      541,      548,      544,
                              551,      541,      553,      539,      550,      543,
                              554,      545,      552,      541,      553,      542,
                              551,      541,      548,      545,      549,      543,
                              549,      543,      549,      543,      548,      580,
                              548,      514,      548,      544,      579,      513,
                              582,      513,      545,     1601,      572,      514,
                              550,      543,      580,      518,      549,      544,
                              547,      544,      569,      522,      549,      543,
                              551,      543,      549,      543,      549,     1593,
                              553,     1606,      574,      509,      584,      506,
                              555,      538,      553,      538,      551,      542,
                              554,      540,      551,      545,      569,      693,
                              382,      545,      548,      543,      548,      556,
                              536,      544,      550,      542,      550,      543,
                              548,      545,      547,      551,      546,      545,
                              547,      545,      549,      544,      547,      578,
                              515,      545,      547,      546,      545,      574,
                              520,      579,      519,      545,      546,      546,
                              546,      546,      546,      573,      519,      546,
                              547,      573,      518,      548,      545,      579,
                              519,      547,      547,      572,      518,      574,
                              522,      571,      517,      574,      519,      546,
                              556,      564,      516,      581,      520,      572,
                              521,      545,      546,      582,      511,      573,
                              518,      550,      542,      547,      550,      544,
                              545,      553,      545,      574,      522,      574,
                              516,      545,      549,      548,      549,      546,
                              544,      544,      545,      547,      545,      554,
                              543,      548,      546,      583,      575,      511,
                              514,      571,      520,      545,      550,      543,
                              548,      547,      548,      551,      547,     1599,
                              547,      547,      547,      543,      546,     1603,
                              547,      544,      547,     1607,      541,      541,
                              558,      551,      537
                             };
int main(void)
{
    u8 i, key_val = 0;

    NVIC_SetPriorityGrouping(NVIC_PriorityGroup_2);
    delay_init();
    My_USART1_Init();
    Key_Init();
		LED_Init();
//    Remote_Init();
    IR_Init();

    while(1)
    {
        key_val = Key_Scan();
        if(key_val)
        {
            switch (key_val)
            {
            case 2:
            {
                for(i=0; i<242; i+=2)
                {
                    IR_Send(1, Code_OFF[i]);
                    IR_Send(0, Code_OFF[i+1]);
                }
                IR_Send(1, Code_OFF[242]);
                TIM_Cmd(TIM3, DISABLE);
                //		IR_Send(1, Code[241]);
                TIM3->CCR4 = 25;
                TIM_Cmd(TIM3, ENABLE);
                break;
            }
            case 3:
            {
                for(i=0; i<242; i+=2)
                {
                    IR_Send(1, Code_ON[i]);
                    IR_Send(0, Code_ON[i+1]);
                }
                IR_Send(1, Code_ON[242]);
                TIM_Cmd(TIM3, DISABLE);
                //		IR_Send(1, Code[241]);
                TIM3->CCR4 = 25;
                TIM_Cmd(TIM3, ENABLE);
                break;
            }
            }
        }
    }
}
/*********************************************光敏**********************************************/
//int main(void)
//{
//	float num;
//	u8 num2;
//	char str[6];
//
//	delay_init();
//	LCD1602_Init();
//	Light_Sensor_Init();
//	while(1)
//	{
//		num = Light_Sensor_GetValue(ADC_Channel_4);
//		num2 = num*100;
//		str[0] = num2/100 + 48;
//		str[1] = '.';
//		str[2] = num2/10%10 + 48;
//		str[3] = num2%10 +48;
//		str[4] = '\0';
//		LCD1602_Write_String(str);
//		delay_ms(1500);
//	}
//}

/***********************************************ESP8266********************************************/
//int main(void)
//{
//	delay_init();
//	NVIC_SetPriorityGrouping(NVIC_PriorityGroup_2);
//	LCD1602_Init();
//	ESP8266_Init();
//	delay_ms(1000);
//	LCD1602_Write_Order(1, 0x01);
//	LCD1602_Write_Order(1, 0x80);
//	My_USART_Send_String(USART2, "AT+CIFSR\r\n");
//	while(1);
//}

/*********************************************AT24C02 EEPROM存储器*******************************/
//int main(void)
//{
//	delay_init();
//	LCD1602_Init();
//	My_I2C_Init();
//
//	AT24C02_Write_Byte(0x00, 'O');
//
//	delay_ms(20);
//
//	LCD1602_Write_Byte(AT24C02_Read_Byte(0x00));
//	while(1);
//}


/*************************************SHT20温湿度传感器****************************************/
//int main(void)
//{
//	char str[23] = "Temper:";
//	int temp;
//
//	delay_init();
//	LCD1602_Init();
//	My_I2C_Init();
//
//	while(1)
//	{
//		//获取温度数据
//		temp = (int)(SHT20_GetValue(1)*100);  //转换成整数 方便操作
//		str[7] = (temp/1000 + 48);
//		str[8] = temp/100%10 + 48;
//		str[9] = '.';
//		str[10] = (temp/10%10 + 48);
//		str[11] = (temp%10 + 48);
//		str[12] = 'C';
//		str[13] = ',';
//
//		//获取湿度数据
//		temp = SHT20_GetValue(0)*100;
//		str[14] = temp/1000%10 + 48;
//		str[15] = temp/100%10 + 48;
//		str[16] = '.';
//		str[17] = temp/10%10 + 48;
//		str[18] = temp%10 + 48;
//		str[19] = '%';
//		str[20] = 'R';
//		str[21] = 'H';
//		str[22] = '\0';  //结束符
//
//		LCD1602_Write_String(str);
//		delay_ms(1000);
//	}
//}


/*****************************************内部温度实验***********************************************/
//int main(void)
//{
//	float temp;
//	char s[11] = "Temp:";
//
//	delay_init();
//	LCD1602_Init();
//	T_ADC_Init();
//
//	while(1)
//	{
//		temp = T_Get_Temper();
//
//		s[5] = (int)temp/10 + 48;
//		s[6] = (int)temp%10 + 48;
//	  s[7] = '.';
//		s[8] = (int)(temp*10)%10 + 48;
//		s[9] = (int)(temp*100)%10 + 48;
//		s[10] = '\0';
//
//		LCD1602_Write_String(s);
//		delay_ms(1000);
//	}
//}

/*******************************************ADC实验**************************************************/
//int main(void)
//{
//	delay_init();
//	LCD1602_Init();
//	My_ADC_Init();
//	//LCD1602_Write_String("OK");
//	while(1)
//	{
//		u8 i;
//
//		char s[20] = "A:";
//		float tempD, tempA;  //tempA 模拟量，tempD 数字量
//		tempD = Get_ADC_Average(1);
//		tempA = (float) tempD*(3.3/4096);
//		s[2] = (char) ((int)tempA%10 + 48);
//		s[3] = '.';
//		s[4] = (char) ((int)(tempA*10)%10+48);
//		s[5] = (char) ((int)(tempA*100)%10+48);
//		s[6] = (char) ((int)(tempA*1000)%10+48);
//		s[7] = ' ';
//		s[8] = 'D';
//		s[9] = ':';
//		for(i=1;i<5;i++)
//		{
//			s[9+i] = (char) ((int)(tempD/pow(10,4-i))%10 + 48);
//		}
//		s[14] = '\0';
//
//		LCD1602_Write_String(s);
//		delay_ms(500);
//	}
//}


//int	main(void)
//{
//	delay_init();
//	NVIC_SetPriorityGrouping(NVIC_PriorityGroup_2);
//	LED_Init();
//	Beep_Init();
//	My_EXTI_Init();
//	while(1)
//	{
//				GPIO_ResetBits(GPIOC, GPIO_Pin_7);
//				delay_ms(500);
//				GPIO_SetBits(GPIOC, GPIO_Pin_7);
//				delay_ms(500);
//	}
//}

//void EXTI15_10_IRQHandler(void)
//{
//	if(EXTI_GetITStatus(EXTI_Line13)!=RESET)
//	{
//		delay_ms(10);
//		if(GPIO_ReadInputDataBit(GPIOC, GPIO_Pin_13)==RESET)
//		{
//			while(GPIO_ReadInputDataBit(GPIOC, GPIO_Pin_13)==RESET)
//			{
//				GPIO_SetBits(GPIOC, GPIO_Pin_8);
//				delay_ms(500);
//				GPIO_ResetBits(GPIOC, GPIO_Pin_8);
//				delay_ms(500);
//			}
//		}
//	}
//	EXTI_ClearITPendingBit(EXTI_Line13);
//}

